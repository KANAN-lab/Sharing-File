<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>DAM Digital Library</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  
  <style>
   html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background: #0a1d3a;
      color: white;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: background-color 0.3s ease;
    }

.container-fluid {
  flex: 1;
  position: relative;
  padding-bottom: 90px;
}

    .content {
      display: none;
      padding: 20px;
      animation: fadeSlide 0.6s ease both;
    }

    .content.active {
      display: block;
    }

    
    @keyframes fadeSlide {
      0% { opacity: 0; transform: translateY(20px) scale(0.98); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes fadeInZoom {
      0% { opacity: 0; transform: scale(0.5) translateX(-50%); }
      100% { opacity: 1; transform: scale(1) translateX(-50%); }
    }



@keyframes popIn {
  0% { transform: scale(0.9); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes slideDownFade {
  0% { opacity: 0; transform: translateY(-30px); }
  100% { opacity: 1; transform: translateY(0); }
}

.home-page .card-menu {
  width: 100%;
  max-width: 180px; /* lebih kecil */
  aspect-ratio: 1 / 1;
  text-align: center;
  border-radius: 20px;
  background-color: white;
  color: #0a1d3a;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  transition: all 0.3s ease-in-out;
  padding: 20px;
  font-weight: bold;
  animation: popIn 0.8s ease forwards;
}
.home-page .card-menu h3 {
  font-size: 1rem;
  margin-top: 8px;
}
.home-page .card-menu i {
  font-size: 2rem;
}


.home-page .card-menu:hover {
  background-color: #1e3a8a;
  color: white;
  transform: scale(1.05);
}


.department-buttons .card-menu {
  padding: 20px;
  text-align: center;
  cursor: pointer;
  border: none;
  border-radius: 10px;
  background-color: white;
  color: #0a1d3a;
  transition: all 0.3s ease-in-out;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  animation: fadeSlide 0.6s ease both;
}

.department-buttons .card-menu h5,
.department-buttons .card-menu i {
  font-size: 1.4rem;
}

.card-menu:hover {
  background-color: #1e3a8a;
  color: white;
  transform: scale(1.05);
}

.hover-button:hover i,
.hover-button:hover h5 {
  color: #1e90ff;
}

.back-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#table-container {
  display: none;
}

iframe {
  width: 100%;
  height: 60vh;
  border: none;
  border-radius: 10px;
  background-color: white;
  pointer-events: auto;
}

#loadingSpinner {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 60vh;
  font-size: 1.5rem;
}

.spinner-border {
  width: 3rem;
  height: 3rem;
  animation: spinner-grow 0.8s linear infinite;
}

@keyframes spinner-grow {
  0% { transform: scale(1); opacity: 0.5; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 0.5; }
}

table {
  background-color: white;
  color: #0a1d3a;
  border-radius: 10px;
  overflow: hidden;
  font-family: 'Poppins', sans-serif;
}

thead {
  background-color: #f8f9fa;
  font-weight: bold;
}

tbody {
  font-weight: normal;
}

tbody tr:hover {
  background-color: #f1f5ff;
  transition: background-color 0.3s ease;
}

.footer {
  background-color: white;
  color: #0a1d3a;
  text-align: center;
  font-size: 0.8rem;
  padding: 10px 0;
  margin-top: 0;
}


.fullscreen-controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

   #button-exit-fullscreen {
      display: none;
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background-color: navy;
      color: white;
      border: none;
      border-radius: 50%;
      width: 55px;
      height: 55px;
      font-size: 18px;
      z-index: 9999;
      cursor: pointer;
      pointer-events: auto;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
    }

    #button-exit-fullscreen i {
      font-size: 22px;
      margin: 0;
    }

    body.presentation-active.fullscreen-mode #button-exit-fullscreen {
      display: flex !important;
      animation: fadeInZoom 0.3s ease forwards;
    }


.animated-header {
  width: 100vw;
  background-color: white;
  color: #0a1d3a;
  padding: 10px 16px;
  margin: 0;
  text-align: center;
  box-sizing: border-box;
  font-weight: bold;
  animation: slideDownFade 0.6s ease-out;
  z-index: 1050;
  position: relative;
}

.home-body {
  margin-top: 60px;
}

.coming-soon-wrapper {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 70vh;
  font-size: 1.6rem;
  text-align: center;
}

.coming-soon-wrapper i {
  font-size: 3rem;
  margin-bottom: 15px;
  color: #fff;
}

@media (max-width: 767px) {
  .home-page .card-menu {
    max-width: 200px;
    padding: 20px;
  }
  .home-page .card-menu h3 {
    font-size: 1.2rem;
  }
  .home-page .card-menu i {
    font-size: 2.5rem;
  }
  .department-buttons .card-menu {
    height: auto;
    padding: 15px;
  }
}

    #presentation-page iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
      pointer-events: auto;
    }

    .ratio {
      max-width: 960px;
      aspect-ratio: 16/9;
      margin: 0 auto;
      background-color: white;
      position: relative;
    }

    /* LOGIN PAGE CUSTOM */
.login-page {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 130px); /* Sesuaikan header + footer */
  padding: 10px 20px;
}


.login-card {
  background-color: white;
  color: #0a1d3a;
  padding: 30px;
  border-radius: 15px;
  width: 100%;
  max-width: 350px;
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
}

.login-card h2 {
  font-weight: bold;
  margin-bottom: 20px;
  text-align: center;
}

.login-card .form-group {
  margin-bottom: 20px;
}

.login-card input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.login-card button {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background-color: #0a1d3a;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.login-card button:hover {
  background-color: #1e3a8a;
}

@media (max-height: 600px) {
  .login-page {
    min-height: auto;
    padding-top: 30px;
    padding-bottom: 30px;
  }
}

@media (max-width: 480px) {
  .login-card {
    padding: 20px;
    border-radius: 10px;
    max-width: 90%;
  }

  .login-card h2 {
    font-size: 1.5rem;
  }

  .login-card input,
  .login-card button {
    font-size: 0.9rem;
    padding: 10px;
  }
}

@media (min-width: 481px) and (max-width: 768px) {
  .login-card {
    max-width: 320px;
    padding: 25px;
  }

  .login-card input,
  .login-card button {
    font-size: 1rem;
  }
}



body.loading .content {
  display: none !important;
}

.home-page .row.g-2 {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px; /* Lebih kecil dari sebelumnya */
  padding: 0 10px;
}


.home-page .d-flex .card-menu {
  margin: 0 !important;
}

/* === WRAPPER UTAMA === */
.calendar-wrapper {
  width: 100%;
  max-width: 1200px;
  margin: 40px auto 30px auto;
  padding: 40px;
  background-color: #ffffff;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

/* === JUDUL KALENDER === */
#calendar-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #0a1d3a;
  text-align: center;
  margin-bottom: 25px;
}

/* === TOMBOL NAVIGASI BULAN === */
.calendar-wrapper .btn {
  background-color: #1e3a8a;
  color: white;
  border: none;
  font-size: 1.2rem;
  padding: 8px 14px;
  border-radius: 6px;
  transition: background 0.3s ease;
}
.calendar-wrapper .btn:hover {
  background-color: #0a1d3a;
}

/* === GRID KALENDER === */
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 12px;
  margin-top: 20px;
}

/* === DEFAULT TIAP KOTAK HARI === */
.calendar-day {
  background-color: #ffffff;
  color: #0a1d3a;
  border-radius: 10px;
  min-height: 110px;
  padding: 10px 12px;
  font-size: 0.9rem;
  position: relative;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border: 1px solid #e0e0e0;
  transition: all 0.25s ease;
}

/* === KOTAK YANG ADA EVENT === */
.calendar-day.has-event {
  background-color: #1e3a8a !important;
  color: #ffffff !important;
}
.calendar-day.has-event .date-number,
.calendar-day.has-event .event-preview {
  color: #ffffff !important;
}

/* === TANGGAL DI POJOK KIRI === */
.calendar-day .date-number {
  font-size: 0.75rem;
  font-weight: bold;
  position: absolute;
  top: 6px;
  left: 8px;
  color: inherit;
}

/* === PREVIEW EVENT === */
.calendar-day .event-preview {
  font-size: 0.75rem;
  margin-top: 24px;
  font-weight: 500;
  line-height: 1.3;
  color: inherit;
}

/* === PENANDA BULAT GANDA DI POJOK KANAN ATAS === */
.calendar-day::after,
.calendar-day::before {
  content: "";
  width: 10px;
  height: 10px;
  border-radius: 50%;
  position: absolute;
  top: 6px;
}

.calendar-day::after {
  right: 6px;
  background-color: transparent;
}
.calendar-day::before {
  right: 20px;
  background-color: transparent;
}

.calendar-day[data-status="Done"]::after {
  background-color: green;
}
.calendar-day[data-status="Scheduled"]::after {
  background-color: red;
}
.calendar-day.today::before {
  background-color: #3b82f6;
}

/* === HOVER UNTUK KOTAK TANPA EVENT === */
.calendar-day:hover {
  transform: translateY(-2px);
  background-color: #f0f5ff;
  cursor: pointer;
}

/* === HOVER UNTUK KOTAK DENGAN EVENT === */
.calendar-day.has-event:hover {
  background-color: #ffffff !important;
  color: #0a1d3a !important;
}
.calendar-day.has-event:hover .date-number,
.calendar-day.has-event:hover .event-preview {
  color: #0a1d3a !important;
}

/* === LEGEND STATUS DI BAWAH === */
.calendar-legend {
  margin-top: 25px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 16px;
}
.calendar-legend .item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.9rem;
  color: #0a1d3a;
  font-weight: 500;
}
.calendar-legend .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
}
.calendar-legend .dot.done {
  background-color: green;
}
.calendar-legend .dot.scheduled {
  background-color: red;
}
.calendar-legend .dot.today {
  background-color: #3b82f6;
}

/* === RESPONSIVE === */
@media (max-width: 1024px) {
  .calendar-wrapper {
    padding: 30px 20px;
  }
  .calendar-grid {
    gap: 10px;
  }
  .calendar-day {
    min-height: 100px;
    font-size: 0.85rem;
  }
}
@media (max-width: 768px) {
  .calendar-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  .calendar-day {
    min-height: 85px;
    padding: 8px 6px;
    font-size: 0.8rem;
  }
  .calendar-day .date-number {
    font-size: 0.7rem;
  }
  #calendar-title {
    font-size: 1.5rem;
  }
}
@media (max-width: 500px) {
  .calendar-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  .calendar-day {
    min-height: 80px;
    font-size: 0.75rem;
  }
}

/* === TAMBAHAN UMUM === */
@media (max-width: 768px) {
  .home-body h3 {
    font-size: 1.2rem;
    margin-top: 20px;
  }
  .card-menu {
    padding: 20px !important;
    max-width: 90% !important;
    margin: 10px auto !important;
      margin: 0 !important;
  flex: 0 1 180px; /* semua card lebar tetap */
    
  }
  .card-menu h3 {
    font-size: 1rem !important;
  }
  .card-menu i {
    font-size: 2rem !important;
  }
  .footer {
    font-size: 0.7rem;
    padding: 6px 10px;
  }
  .calendar-wrapper {
    padding: 20px;
  }
}
@media (max-width: 400px) {
  .card-menu h3 {
    font-size: 0.9rem !important;
  }
  .card-menu i {
    font-size: 1.6rem !important;
  }
}
@media (max-width: 600px), (orientation: portrait) {
  .home-page .card-menu {
    max-width: 160px !important;
    padding: 16px !important;
  }
  .home-page .card-menu h3 {
    font-size: 1rem !important;
    margin-top: 8px;
  }
  .home-page .card-menu i {
    font-size: 2rem !important;
  }
}

#logoutBtn:hover {
  background-color: #ffffff;
  color: #0a1d3a;
  transition: all 0.3s ease;
}

.back-btn:hover {
  background-color: #ffffff;
  color: #0a1d3a;
  transition: all 0.3s ease;
}

.btn-today {
  background-color: #1e3a8a;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  font-weight: 500;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.btn-today:hover {
  background-color: #142b6f;
  transform: scale(1.05);
}

.animated-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  background-color: white;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
  position: relative;
  width: 100%;
  z-index: 1050;
  height: 80px;
}

.logo-kiri,
.logo-kanan {
  height: 56px;
  width: auto;
  object-fit: contain;
}

/* ‚¨áÔ∏è Pakai wrapper kiri dan kanan agar bisa dipaksa sama lebarnya */
.header-side {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}
.header-side.right {
  justify-content: flex-end;
}

.judul-header {
  font-size: 1.6rem;
  font-weight: 700;
  color: #0a1d3a;
  font-family: 'Poppins', sans-serif;
  margin: 0;
  text-align: center;
  flex: 0 0 auto;
}

/* Responsif */
@media (max-width: 768px) {
  .animated-header {
    flex-direction: column;
    height: auto;
    padding: 10px;
    gap: 8px;
  }

  .logo-kiri,
  .logo-kanan {
    height: 45px;
  }

  .judul-header {
    font-size: 1.3rem;
  }

  .header-side {
    justify-content: center !important;
  }
}

#monthSelector:focus {
  border-color: #0a1d3a;
  box-shadow: 0 0 0 0.2rem rgba(10, 29, 58, 0.25);
}

/* === MY COURSES PAGE === */
.my-courses-page .profile-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin-bottom: 30px;
}

.profile-picture {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #1e3a8a;
  background-color: #f0f0f0;
}

.upload-label {
  font-size: 0.9rem;
  margin-top: 6px;
  color: #888;
}

.profile-info {
  width: 100%;
  max-width: 500px;
  background-color: #fff;
  color: #0a1d3a;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.profile-info .info-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

.profile-info .info-row span:first-child {
  font-weight: 600;
  color: #555;
}

.training-table {
  width: 100%;
  background-color: #fff;
  color: #0a1d3a;
  border-radius: 10px;
  overflow: hidden;
  margin-top: 20px;
}

.training-table th, .training-table td {
  padding: 10px 12px;
  font-size: 0.9rem;
  text-align: center;
}

.training-table thead {
  background-color: #1e3a8a;
  color: white;
}

.training-table tbody tr:nth-child(even) {
  background-color: #f6f9ff;
}

/* === CENTER JUDUL & NAVIGATION KALENDER DENGAN GAP === */
.calendar-header-group {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 14px;
}

@media (max-width: 768px) {
  .calendar-header-group {
    flex-wrap: wrap;
    gap: 10px;
  }

  .profile-info .info-row {
    flex-direction: column;
    align-items: flex-start;
  }
}

/* === RESPONSIF UNTUK TOMBOL & SELECT KALENDER === */
@media (max-width: 768px) {
  #monthSelector {
    min-width: 120px;
  }
}



  </style>

<!-- ‚úÖ HEADER -->
<body class="loading">
<div class="animated-header">
  <!-- Logo Kiri -->
  <div class="header-side">
    <img src="https://github.com/KANAN-lab/WFG-DAM/blob/main/FINAL%20LOGO%20PT%20DAM_CR.png?raw=true" alt="Logo DAM" class="logo-kiri">
  </div>

  <!-- Judul -->
  <h1 class="judul-header">DAM LEARNING MANAGEMENT SYSTEM</h1>

  <!-- Logo Kanan -->
  <div class="header-side right">
    <img src="https://upload.wikimedia.org/wikipedia/commons/9/99/Wings_%28Indonesian_company%29_logo.svg" alt="Logo Kanan" class="logo-kanan">
  </div>
</div>


  <div class="text-end me-3">
    <button onclick="logout()" id="logoutBtn" class="btn btn-outline-light btn-sm rounded-pill px-4 py-2" style="display: none; position: absolute; flex: 15px; right: 20px; z-index: 1000;">
  <i class="fas fa-sign-out-alt me-1"></i> Logout
</button>

  </div>

  <!-- ‚úÖ LOGIN PAGE -->
  <div id="login-page" class="content login-page active">
    <div class="login-card position-relative">
      <h2>Login</h2>
      <form id="loginForm">
        <div class="form-group">
          <input type="text" id="inputId" class="form-control" placeholder="ID" required>
        </div>

        <div class="form-group position-relative">
          <input type="password" id="inputPassword" class="form-control" placeholder="Password" required>
          <span onclick="togglePassword()" style="position:absolute; right:10px; top:10px; cursor:pointer; color:#0a1d3a;">
            <i id="toggleIcon" class="fas fa-eye"></i>
          </span>
        </div>

        <button type="submit" class="btn btn-primary w-100 mt-2">Login</button>
      </form>
    </div>
  </div>

  <!-- ‚úÖ MAIN CONTAINER -->
  <div class="container-fluid">

  <!-- ‚úÖ HOME PAGE -->
<div id="home-page" class="content text-center home-page">
  <div class="home-body">
    <div class="text-white mt-4">
      <h3 class="fw-semibold">Hi <span id="namaKaryawanText">  </span></h3>
      <p class="mt-4 fs-5 fw-semibold">Selamat datang di DAM - Learning Management System</p>
    </div>

<div class="d-flex flex-wrap justify-content-center gap-3 my-4">
  <div class="card card-menu p-4" onclick="goToPage('module-page')">
    <h3><i class="fas fa-book-open mb-2"></i><br />Training Module</h3>
  </div>
  <div class="card card-menu p-4" onclick="goToPage('training-video')">
    <h3><i class="fas fa-video mb-2"></i><br />Training Video</h3>
  </div>
  <div class="card card-menu p-4" onclick="goToPage('training-calendar')">
    <h3><i class="fas fa-calendar-alt mb-2"></i><br />Kalender Training</h3>
  </div>
  <div class="card card-menu p-4" onclick="goToPage('my-courses-page')">
    <h3><i class="fas fa-user-graduate mb-2"></i><br />My Profile</h3>
  </div>
</div>

    <p class="fst-italic mt-2">"Knowledge is power. Information is liberating. Education is the premise of progress."</p>
  </div>
</div>

<!-- ‚úÖ MY COURSES PAGE -->
<div id="my-courses-page" class="content">
  <h2 class="text-center fw-semibold mb-4">Profil Karyawan</h2>

  <div class="row justify-content-center mb-4">
   <div class="col-md-3 text-center">
  <img id="fotoKaryawan" src="https://github.com/KANAN-lab/WFG-DAM/blob/main/FINAL%20LOGO%20PT%20DAM_CR.png" class="rounded-circle mb-3 shadow" alt="Foto Karyawan" style="width: 140px; height: 140px; object-fit: cover; border: 3px solid #1e3a8a; background-color: #f0f0f0;">
  
  <div class="d-grid gap-2">
    <input type="file" id="uploadFoto" class="form-control form-control-sm" accept="image/*" onchange="previewFoto(event)">
    <button class="btn btn-success btn-sm fw-semibold mt-2" onclick="simpanFoto()">üíæ Simpan Foto</button>
  </div>
</div>

    <div class="col-md-5">
      <div class="mb-2"><strong>Nama:</strong> Syahrul Naufal Kurnia</div>
      <div class="mb-2"><strong>Tempat, Tanggal Lahir:</strong> Bandung, 1 Januari 1998</div>
      <div class="mb-2"><strong>Departemen:</strong> Training & Development</div>
      <div class="mb-2"><strong>Posisi Jabatan:</strong> Learning Coordinator</div>
    </div>
  </div>

  <h4 class="text-center fw-semibold mb-3">Riwayat Training</h4>
  <div class="table-responsive">
    <table class="table table-bordered text-center">
      <thead class="table-light">
        <tr>
          <th>No</th>
          <th>Nama Training</th>
          <th>Tanggal Pelaksanaan</th>
          <th>Tanggal Selesai</th>
          <th>Pre Test</th>
          <th>Post Test</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>Basic Safety Awareness</td>
          <td>2024-03-01</td>
          <td>2024-03-01</td>
          <td>65</td>
          <td>90</td>
          <td><span class="badge bg-success">Lulus</span></td>
        </tr>
        <tr>
          <td>2</td>
          <td>5S Implementation</td>
          <td>2024-04-10</td>
          <td>2024-04-10</td>
          <td>70</td>
          <td>82</td>
          <td><span class="badge bg-success">Lulus</span></td>
        </tr>
        <tr>
          <td>3</td>
          <td>Fire Drill Training</td>
          <td>2024-05-05</td>
          <td>2024-05-05</td>
          <td>60</td>
          <td>65</td>
          <td><span class="badge bg-danger">Tidak Lulus</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="text-center mt-4">
    <button class="btn btn-outline-light back-btn px-4 py-2 fw-semibold border border-white rounded" onclick="goToPage('home-page')">
      <i class="fas fa-arrow-left me-2"></i>Back
    </button>
  </div>
</div>


    <!-- ‚úÖ MODULE PAGE -->
    <div id="module-page" class="content">
      <h2 class="text-center fw-semibold">Pilih Modul</h2>
      <div class="row g-3 mt-3 department-buttons" id="department-buttons"></div>
       <button class="btn btn-outline-light rounded-pill px-4 py-2 back-btn" onclick="goToPage('home-page')">
  <i class="fas fa-arrow-left me-2"></i> Back
</button>

    </div>

    <!-- ‚úÖ TABLE PAGE -->
    <div id="table-page" class="content">
      <h3 id="table-title" class="text-center fw-semibold"></h3>
      <div id="loadingSpinner">
        <div class="spinner-border text-light" role="status"></div>
        <p class="mt-4">Loading, please wait...</p>
      </div>
      <div id="table-container" class="table-responsive mt-4">
        <table class="table table-striped table-hover text-center">
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Modul</th>
              <th>Type</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="module-table-body"></tbody>
        </table>
        <nav>
          <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>
      </div>
       <button class="btn btn-outline-light back-btn px-4 py-2 fw-semibold border border-white rounded" onclick="goToPage('module-page')">
      <i class="fas fa-arrow-left me-2"></i>Back
    </button>
    </div>


<!-- ‚úÖ CALENDAR PAGE -->
<div id="training-calendar" class="content calendar-page active">
  <div class="container d-flex justify-content-center">
    <div class="calendar-wrapper bg-white p-4 rounded">

      <!-- ‚úÖ Navigasi Bulan + Judul + Hari Ini -->
<div class="d-flex flex-wrap gap-3 align-items-center justify-content-between mb-3">

  <!-- Dropdown Bulan -->
  <div class="d-flex align-items-center gap-2">
    <label for="monthSelector" class="form-label m-0 fw-semibold text-dark">Bulan:</label>
    <select id="monthSelector" class="form-select shadow-sm rounded" onchange="goToSelectedMonth()" style="min-width: 160px;">
      <option disabled selected value="">Bulan</option>
      <option value="0">Januari</option>
      <option value="1">Februari</option>
      <option value="2">Maret</option>
      <option value="3">April</option>
      <option value="4">Mei</option>
      <option value="5">Juni</option>
      <option value="6">Juli</option>
      <option value="7">Agustus</option>
      <option value="8">September</option>
      <option value="9">Oktober</option>
      <option value="10">November</option>
      <option value="11">Desember</option>
    </select>
  </div>

  <!-- Navigasi Panah dan Judul Bulan -->
  <div class="d-flex align-items-center justify-content-center gap-4 flex-grow-1 flex-wrap text-center">
    <button class="btn btn-primary rounded" onclick="prevMonth()">&#8592;</button>
    <h3 id="calendar-title" class="fw-semibold m-0 text-dark px-4" style="min-width: 160px;"></h3>
    <button class="btn btn-primary rounded" onclick="nextMonth()">&#8594;</button>
  </div>

  <!-- Tombol Hari Ini -->
  <div>
    <button class="btn btn-today" onclick="goToToday()">üìÖ Hari Ini</button>
  </div>
</div>


      <!-- ‚úÖ Grid Kalender -->
      <div class="calendar-grid" id="calendar-grid">
        <!-- Akan digenerate oleh JS -->
      </div>

      <!-- ‚úÖ LEGEND STATUS -->
      <div class="calendar-legend mt-4">
        <div class="item"><span class="dot done"></span> Done</div>
        <div class="item"><span class="dot scheduled"></span> Scheduled</div>
        <div class="item"><span class="dot today"></span> Hari Ini</div>
      </div>
    </div>
  </div>
  <button class="btn btn-outline-light back-btn px-4 py-2 fw-semibold border border-white rounded" onclick="goToPage('home-page')">
    <i class="fas fa-arrow-left me-2"></i>Back
  </button>
</div>




    <!-- ‚úÖ PRESENTATION PAGE -->
    <div id="presentation-page" class="content">
      <h3 class="text-center">Modul Presentasi</h3>
      <div class="ratio rounded overflow-hidden border" id="presentationWrapper">
        <button id="button-exit-fullscreen" class="position-absolute" title="Exit Fullscreen">
          <i class="fas fa-times"></i>
        </button>
        <iframe id="presentationFrame" src="" allowfullscreen></iframe>
      </div>
      <div class="fullscreen-controls mt-3 text-center">
        <button class="btn btn-primary" onclick="enterFullscreen()">Fullscreen</button>
      </div>
      <button class="btn btn-outline-light back-btn px-4 py-2 fw-semibold border border-white rounded" onclick="goToPage('table-page')">
      <i class="fas fa-arrow-left me-2"></i>Back
    </button>
    </div>

    <!-- ‚úÖ VIDEO PAGE -->
    <div id="training-video" class="content">
      <div class="coming-soon-wrapper">
        <i class="fas fa-tools"></i>
        <div><strong>Coming Soon</strong></div>
      </div>
     <button class="btn btn-outline-light back-btn px-4 py-2 fw-semibold border border-white rounded" onclick="goToPage('')">
      <i class="fas fa-arrow-left me-2"></i>Back
    </button>
    </div>

  </div>

  <!-- ‚úÖ FOOTER -->
  <div class="footer">
    <b>Copyright by Training & Development PT.Daya Anugrah Mulya - Syahrul Naufal Kurnia</b>
  </div>

<!-- Load SweetAlert2 DULU dengan script SENDIRI -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Baru setelah itu, semua JS kamu -->
<script>

var departments = [
  { name: 'Modul Production', icon: 'industry' },
  { name: 'Modul QCD', icon: 'flask' },
  { name: 'Modul Logistic', icon: 'truck' },
  { name: 'Modul Engineering', icon: 'tools' },
  { name: 'Modul HRD & GA', icon: 'users' },
  { name: 'Modul General', icon: 'globe' },
  { name: 'Modul EHS', icon: 'shield-alt' },
  { name: 'Modul WCO', icon: 'cogs' },
  { name: 'Modul Manex', icon: 'sitemap' }
];

var allData = [];
var selectedDepartment = null;
var currentPage = 1;
var rowsPerPage = 5;
var isLoggedIn = false;

window.onload = () => {
  // üîí Sembunyikan semua page & tombol logout dulu untuk cegah flicker
  document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
  const logoutButton = document.getElementById('logoutBtn');
  if (logoutButton) logoutButton.style.display = 'none';

  // üîÑ Generate tombol departemen
  const container = document.getElementById('department-buttons');
  departments.forEach(dep => {
    const col = document.createElement('div');
    col.className = 'col-md-3';
    col.innerHTML = `
      <div class="card card-menu hover-button" onclick="loadDepartment('${dep.name}')">
        <div class="card-body">
          <i class="fas fa-${dep.icon} fa-2x"></i>
          <h5 class="mt-2">${dep.name}</h5>
        </div>
      </div>`;
    container.appendChild(col);
    document.body.classList.remove('loading');
  });

  // üîê Cek login status dari localStorage
  const stayLoggedIn = localStorage.getItem('damLoggedIn') === 'true';
  const savedId = localStorage.getItem('damUserId');

 if (stayLoggedIn && savedId) {
  isLoggedIn = true;
  goToPage('home-page');
  document.getElementById('login-page').style.display = 'none';
  
  const nama = localStorage.getItem('damNamaKaryawan');
  if (nama) {
    document.getElementById("namaKaryawanText").textContent = nama;
  }

  resetIdleTimer();
}
 else {
    isLoggedIn = false;
    goToPage('login-page');
    document.getElementById('login-page').style.display = 'flex';
  }

  // ‚å®Ô∏è Gunakan event submit form agar tombol enter juga trigger login()
  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault(); // cegah reload form
      doLogin();  // ‚Üê sesuai dengan nama fungsi di login.html
    });
  }
};



function resetIdleTimer() {
  clearTimeout(idleTimeout);
  idleTimeout = setTimeout(() => {
    if (isLoggedIn) {
      Swal.fire({
        icon: 'warning',
        title: 'Logout Otomatis',
        text: 'Anda tidak aktif selama 15 menit. Silakan login ulang.',
        showConfirmButton: true
      }).then(() => {
        logout();
      });
    }
  }, 15 * 60 * 1000); // 15 menit = 900000ms
}

// Deteksi segala aktivitas user
['mousemove', 'keydown', 'click', 'scroll', 'touchstart'].forEach(evt => {
  document.addEventListener(evt, resetIdleTimer, false);
});


// Deteksi semua aktifitas user
['mousemove', 'keydown', 'click', 'scroll', 'touchstart'].forEach(evt => {
  document.addEventListener(evt, resetIdleTimer, false);
});



function loadDepartment(department) {
  goToPage('table-page');
  selectedDepartment = department;
  document.getElementById('table-title').textContent = `Departemen: ${department}`;
  document.getElementById('loadingSpinner').style.display = 'flex';
  document.getElementById('table-container').style.display = 'none';

  google.script.run.withSuccessHandler(data => {
    allData = data.filter(row => row.sheet === department);
    currentPage = 1;
    renderTable();
  }).getLibraryData();
}

function renderTable() {
  const start = (currentPage - 1) * rowsPerPage;
  const paginated = allData.slice(start, start + rowsPerPage);

  const tbody = document.getElementById('module-table-body');
  tbody.innerHTML = '';
  paginated.forEach((row, idx) => {
    const buttonText = row.linkModul?.trim() ? 'Lihat Modul' : 'On Developing';
    const buttonAction = row.linkModul?.trim() ? `onclick="openPresentation('${row.linkModul}')"` : 'disabled';
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${start + idx + 1}</td>
      <td>${row.namaModul}</td>
      <td>${row.type}</td>
      <td><button class="btn btn-sm btn-primary" ${buttonAction}>${buttonText}</button></td>`;
    tbody.appendChild(tr);
  });

  const totalPages = Math.ceil(allData.length / rowsPerPage);
  const pagination = document.getElementById('pagination');
  pagination.innerHTML = '';
  for (let i = 1; i <= totalPages; i++) {
    pagination.innerHTML += `
      <li class="page-item ${i === currentPage ? 'active' : ''}">
        <a class="page-link" href="#" onclick="goToPageNum(${i})">${i}</a>
      </li>`;
  }

  document.getElementById('loadingSpinner').style.display = 'none';
  document.getElementById('table-container').style.display = 'block';
}

function goToPageNum(num) {
  currentPage = num;
  renderTable();
}

function goToPage(id) {
  // Cek login status sebelum ganti halaman
  if (!isLoggedIn && id !== 'login-page') {
    Swal.fire({
      icon: 'info',
      title: 'Belum Login',
      text: 'Silahkan login terlebih dahulu.',
    });
    return;
  }

  // Pindah ke halaman target
  document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.body.classList.toggle('presentation-active', id === 'presentation-page');

  // Tampilkan/sembunyikan tombol logout lebih awal
  const logoutButton = document.getElementById('logoutBtn');
  if (logoutButton) {
    if (id === 'login-page') {
      logoutButton.style.display = 'none';
    } else {
      logoutButton.style.display = 'inline-block';
    }
  }
}


function enterFullscreen() {
  const container = document.querySelector('#presentationWrapper');
  if (container.requestFullscreen) container.requestFullscreen();
  else if (container.webkitRequestFullscreen) container.webkitRequestFullscreen();
  else if (container.msRequestFullscreen) container.msRequestFullscreen();
}

function exitFullscreen() {
  if (document.exitFullscreen) document.exitFullscreen();
  else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
  else if (document.msExitFullscreen) document.msExitFullscreen();
}

document.getElementById('button-exit-fullscreen').onclick = exitFullscreen;

function checkFullscreen() {
  const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
  const isActive = document.getElementById('presentation-page').classList.contains('active');
  document.body.classList.toggle('fullscreen-mode', !!isFullscreen && isActive);
}

document.addEventListener('fullscreenchange', checkFullscreen);
document.addEventListener('webkitfullscreenchange', checkFullscreen);
document.addEventListener('msfullscreenchange', checkFullscreen);


var events = {};
var currentDate = new Date();
var currentYearOnly = new Date().getFullYear();
var currentMonth = new Date().getMonth();
var currentYear = new Date().getFullYear();


// ‚úÖ Tambahan penting agar calendarGrid dan calendarTitle tidak null
const calendarTitle = document.getElementById("calendar-title");
const calendarGrid = document.getElementById("calendar-grid");

function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const todayStr = new Date().toISOString().split("T")[0];

  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);

  const calendarTitle = document.getElementById("calendar-title");
  const calendarGrid = document.getElementById("calendar-grid");

  calendarTitle.textContent = `${firstDay.toLocaleString("default", { month: "long" })} ${year}`;
  calendarGrid.innerHTML = "";

  const startDay = firstDay.getDay();
  for (let i = 0; i < startDay; i++) {
    const empty = document.createElement("div");
    calendarGrid.appendChild(empty);
  }

  for (let day = 1; day <= lastDay.getDate(); day++) {
    const dateStr = `${year}-${(month + 1).toString().padStart(2, "0")}-${day.toString().padStart(2, "0")}`;
    const cell = document.createElement("div");
    cell.className = "calendar-day";

    // Tanggal pojok kiri atas
    const dateLabel = document.createElement("div");
    dateLabel.className = "date-number";
    dateLabel.textContent = `${day} ${firstDay.toLocaleString("default", { month: "short" })}`;
    cell.appendChild(dateLabel);

    // Hari ini ‚Üí class khusus
    if (dateStr === todayStr) {
      cell.classList.add("today");
    }

    // Jika ada event
    if (events[dateStr]) {
      const firstEvent = events[dateStr][0];
      cell.classList.add("has-event");
      cell.setAttribute("data-status", firstEvent.status); // penting agar css status aktif

      // Event preview
      const preview = document.createElement("div");
      preview.className = "event-preview";
      preview.textContent = `${firstEvent.training} (Batch ${firstEvent.batch})`;
      cell.appendChild(preview);

      // Klik untuk popup
      cell.onclick = () => showEventPopup(dateStr);
    }

    calendarGrid.appendChild(cell);
  }
}

function showEventPopup(dateStr) {
  const items = events[dateStr] || [];

  const eventDate = new Date(dateStr);
  const formattedDate = eventDate.toLocaleDateString("id-ID", {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  const html = `
    <div style="text-align:center; font-size: 1.2rem; font-weight:bold; margin-bottom: 12px; color:#0a1d3a;">
      üìã Detail Kegiatan
    </div>
    ${items.map(ev => `
      <div style="text-align: left; line-height: 1.6; font-size: 0.95rem;">
        
        <!-- Nama Training -->
        <div style="margin-bottom: 6px;">
          üßæ <b>Nama Training:</b> ${ev.training}
        </div>

        <!-- Batch -->
        <div>
          üî¢ <b>Batch:</b> ${ev.batch}
        </div>

        <!-- Tanggal -->
        <div>
          üìÖ <b>Tanggal Pelaksanaan:</b> ${formattedDate}
        </div>

        <!-- Jam -->
        <div>
          ‚è∞ <b>Jam:</b> ${ev.jamMulai} - ${ev.jamSelesai}
        </div>

        <!-- Ruangan -->
        <div>
          üè¢ <b>Ruangan:</b> ${ev.ruangan}
        </div>

        <!-- Pemateri -->
        <div>
          üë§ <b>Pemateri:</b> ${ev.pemateri}
        </div>

        <!-- Departemen -->
        <div>
          üìÇ <b>Departemen:</b> ${ev.departemen}
        </div>

        <!-- Status -->
        <div>
          ‚úÖ <b>Status:</b> 
          <span style="color: ${ev.status === 'Done' ? 'green' : 'red'}; font-weight: bold;">
            ${ev.status}
          </span>
        </div>
      </div>
    `).join("<hr style='margin: 14px 0;'/>")}
  `;

  Swal.fire({
    html,
    confirmButtonText: "Tutup",
    width: 500,
    padding: "1.5em",
    background: "#fff",
    showCloseButton: true,
    customClass: {
      popup: 'text-start'
    }
  });
}



function prevMonth() {
  const testDate = new Date(currentDate);
  testDate.setMonth(testDate.getMonth() - 1);
  if (testDate.getFullYear() === currentYearOnly) {
    currentDate = testDate;
    renderCalendar();
  } else {
    Swal.fire({
      icon: 'info',
      title: 'Batas Tahun',
      text: 'Anda tidak bisa melihat kalender di luar tahun ini.'
    });
  }
}


function nextMonth() {
  const testDate = new Date(currentDate);
  testDate.setMonth(testDate.getMonth() + 1);
  if (testDate.getFullYear() === currentYearOnly) {
    currentDate = testDate;
    renderCalendar();
  } else {
    Swal.fire({
      icon: 'info',
      title: 'Batas Tahun',
      text: 'Anda tidak bisa melihat kalender di luar tahun ini.'
    });
  }
}


function goToToday() {
  currentDate = new Date(); // reset ke hari ini
  renderCalendar();
}


document.addEventListener("DOMContentLoaded", () => {
  google.script.run.withSuccessHandler(res => {
    console.log("EVENT DITERIMA:", res);
    events = res || {}; // fallback agar tidak null
    renderCalendar();

    // Set dropdown bulan ke bulan saat ini
    document.getElementById("monthSelector").value = currentDate.getMonth();
  }).getTrainingEvents();
});


function tampilkanNamaKaryawan(id) {
  google.script.run.withSuccessHandler(nama => {
    if (nama) {
      document.getElementById("namaKaryawanText").textContent = nama;
    } else {
      document.getElementById("namaKaryawanText").textContent = '[Tidak Diketahui]';
    }
  }).getNamaKaryawanById(id);
}

function goToSelectedMonth() {
  const selector = document.getElementById("monthSelector");
  const selectedMonth = parseInt(selector.value);

  // Set tanggal ke 1 agar aman (hindari error saat pilih bulan dengan hari lebih sedikit)
  currentDate.setDate(1);
  currentDate.setMonth(selectedMonth);

  renderCalendar();
}

function previewFoto(event) {
  const img = document.getElementById("fotoKaryawan");
  const file = event.target.files[0];
  if (file) {
    img.src = URL.createObjectURL(file);
    img.dataset.selected = "true"; // tandai kalau user ganti foto
  }
}

function simpanFoto() {
  const fileInput = document.getElementById("uploadFoto");
  const file = fileInput.files[0];

  if (!file) {
    Swal.fire({
      icon: 'info',
      title: 'Tidak Ada Foto',
      text: 'Silakan pilih foto terlebih dahulu.'
    });
    return;
  }

  const userId = localStorage.getItem('damUserId');
  console.log("User ID:", userId); // Log ID untuk debugging

  if (!userId) {
    Swal.fire({
      icon: 'error',
      title: 'Gagal Upload',
      text: 'User ID tidak ditemukan. Silakan login ulang.'
    });
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64Image = e.target.result;

    Swal.fire({
      title: 'Menyimpan Foto...',
      allowOutsideClick: false,
      didOpen: () => Swal.showLoading()
    });

    // Kirim foto dan userId ke server menggunakan google.script.run
    google.script.run.withSuccessHandler(() => {
      Swal.fire({
        icon: 'success',
        title: 'Foto Berhasil Disimpan',
        timer: 1500,
        showConfirmButton: false
      });
    }).withFailureHandler(err => {
      Swal.fire({
        icon: 'error',
        title: 'Gagal Upload',
        text: err.message
      });
    }).simpanFotoProfile(base64Image, userId);
  };

  reader.readAsDataURL(file);
}

function simpanFotoProfile(base64Image, userId) {
  try {
    // Lakukan decoding gambar base64
    const decodedImage = Utilities.base64Decode(base64Image.split(',')[1]);
    
    // Simpan gambar ke Google Drive (misalnya)
    const folder = DriveApp.getFolderById('1SdS8t3M9tUnu5PLoAsYTD-zUlc5mTFTZ'); // Ganti dengan ID folder Google Drive Anda
    const blob = Utilities.newBlob(decodedImage, 'image/jpeg', 'profile_' + userId + '.jpg');
    const file = folder.createFile(blob);

    // Simpan URL file di spreadsheet atau tempat lainnya
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName("UserProfiles"); // Ganti dengan sheet yang sesuai
    sheet.appendRow([userId, file.getUrl(), new Date()]);
    
    return "File berhasil disimpan!";
  } catch (e) {
    Logger.log(e.message);
    throw new Error("Terjadi kesalahan saat menyimpan foto.");
  }
}
</script>

<!-- training.html -->
<!-- pastikan SweetAlert2 sudah di-include di atas -->
<script>
function logout() {
  Swal.fire({
    title: 'Konfirmasi Logout',
    text:  'Apakah Anda yakin ingin logout?',
    icon:  'warning',
    showCancelButton:  true,
    confirmButtonText: 'Ya, Logout',
    cancelButtonText:  'Batal',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      // 1) Hapus session/localStorage
      localStorage.removeItem('damLoggedIn');
      localStorage.removeItem('damUserId');
      localStorage.removeItem('damNamaKaryawan');

      // 2) Kosongkan field ID & Password di form (opsional)
      const idField = document.getElementById('inputId');
      const pwField = document.getElementById('inputPassword');
      if (idField) idField.value = '';
      if (pwField) pwField.value = '';

      // 3) Tampilkan notifikasi sukses, lalu redirect ke URL Web App Anda
      Swal.fire({
        icon: 'success',
        title: 'Anda telah logout',
        showConfirmButton: false,
        timer: 1200
      }).then(() => {
        window.location.href = 
          'https://script.google.com/a/macros/pt-dam-id.com/s/AKfycby84ZSPeZHNFBBVyKvOXjPAZWiJL3XV4YD1yjveGr6OM_z0JexcjK-jTaJfprF3ddRA/exec';
      });
    }
  });
}
</script>

<script>
function openPresentation(link) {
  // 1) Paksa semua http:// atau protocol-relative // jadi https://
  let secure = link
    .replace(/^http:\/\//i, 'https://')
    .replace(/^\/\//, 'https://');

  // 2) Google Slides ‚Üí embed preview
  secure = secure
    .replace('/edit', '/preview')
    .replace('/pub', '/embed');

  // 3) Set src dan tampilkan halaman presentation
  document.getElementById('presentationFrame').src = secure;
  goToPage('presentation-page');
}
</script>




</body>
</html>
